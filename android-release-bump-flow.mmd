flowchart TD
    START([ðŸš€ Start Release]) --> PREFLIGHT

    PREFLIGHT[Pre-flight Checks\nmain branch Â· clean tree\nkeystore.properties] -->|Fail| ABORT([âŒ Abort])
    PREFLIGHT -->|Pass| DISCOVER

    DISCOVER[Discover App Name\ntags â†’ gradle â†’ ask user] --> ANALYZE

    ANALYZE[Analyze Commits\nsince last tag] --> CP_VERSION

    CP_VERSION{{âœ‹ Version Recommendation\nMAJOR / MINOR / PATCH}}
    CP_VERSION -->|Approved| UPDATE
    CP_VERSION -->|Override| CP_VERSION

    UPDATE[Update build.gradle.kts\nversionCode +1 Â· versionName] --> NOTES

    NOTES[Generate Release Notes\nauto-detect locales Â· 500 char limit] --> CP_NOTES

    CP_NOTES{{âœ‹ Review Release Notes}}
    CP_NOTES -->|Approved| VERIFY
    CP_NOTES -->|Edit| NOTES

    VERIFY[Pre-commit Verification\nbuild Â· lint Â· test] -->|Fail| ABORT_VERIFY([âŒ Fix & retry])
    VERIFY -->|Pass| COMMIT

    COMMIT[Commit & Tag\nversion bump + git tag] --> CP_PUSH

    CP_PUSH{{âœ‹ Confirm Push}}
    CP_PUSH -->|Approved| PUSH

    PUSH[Push to origin/main\n+ push tag] --> BUNDLE

    BUNDLE[Build Signed Bundle\ncopyReleaseBundle] --> PLAY_CHECK

    PLAY_CHECK{Upload to\nPlay Console?}
    PLAY_CHECK -->|No| REPORT
    PLAY_CHECK -->|Yes| CP_UPLOAD

    CP_UPLOAD{{âœ‹ Confirm Upload}}
    CP_UPLOAD -->|Approved| UPLOAD
    CP_UPLOAD -->|Skip| REPORT

    UPLOAD[Publish to\nInternal Testing] --> REPORT

    REPORT[/ðŸ“‹ Completion Report/] --> DONE([âœ… Done])

    classDef checkpoint fill:#FFF3CD,stroke:#FFC107,stroke-width:2px,color:#856404
    classDef abort fill:#F8D7DA,stroke:#DC3545,stroke-width:2px,color:#721C24
    classDef success fill:#D4EDDA,stroke:#28A745,stroke-width:2px,color:#155724
    classDef report fill:#D1ECF1,stroke:#17A2B8,stroke-width:2px,color:#0C5460

    class CP_VERSION,CP_NOTES,CP_PUSH,CP_UPLOAD checkpoint
    class ABORT,ABORT_VERIFY abort
    class DONE success
    class REPORT report
